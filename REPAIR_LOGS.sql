
-- REPAIR_LOGS.sql
-- Run this in Supabase SQL Editor to restore the missing error_logs table.

CREATE TABLE IF NOT EXISTS public.error_logs (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
    service text NOT NULL,
    error_level text NOT NULL,
    message text,
    details jsonb
);

-- Enable RLS (Security)
ALTER TABLE public.error_logs ENABLE ROW LEVEL SECURITY;

-- Allow anon/service role to insert logs (needed for Python scripts)
CREATE POLICY "Enable insert for all users" ON public.error_logs
    FOR INSERT
    WITH CHECK (true);

-- Allow admins/service role to view logs
CREATE POLICY "Enable view for service role" ON public.error_logs
    FOR SELECT
    USING (true);
